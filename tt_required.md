 # 要求仕様書
 ## 戦績管理システム
 E16-5410　鈴木萌那
 <br>更新日：2018年7月26日


 ## 1.はじめに
 ### 1.1要求仕様の目的
 卓球の戦績を管理するため

 ### 1.2アクター
 | アクター | 説明 |
 |------|------|
 |利用者|・利用者登録によって、ログインID、パスワードが登録される<br>・大会（大会名、期間、開催場所）を登録できる<br>・選手（名前、戦型、ラバーの種類）を登録できる<br>・選手が出場した大会を登録できる<br>・対戦結果(対戦選手名、大会名、対戦日、ゲームカウント、どの位置で対戦したか(例：準決勝))を登録できる<br>・大会と対戦相手を指定すると、試合結果を表示できる(大会はトーナメント方式とする)|

 ### 1.3用語定義
  |用語 | 説明 |
  |------|-----|
  |利用者|利用者登録をすることでログインID、パスワードが登録されており、その登録されているログインID、パスワードによってログインした者。|
  |選手|利用者によってDBの「選手」として登録された者。|

  ### 1.4概要
  卓球の戦績を管理するシステム

  ## 2.機能
  ### 2.1利用者の機能
  |ID|機能名|理由|説明|
  |----|----|-----|-----|
  |2.1.1|ログイン|許可された利用者のみ、システムの機能を使用することができるようにするため。|利用者登録後にログインを行うことができる。ログインIDとパスワードを自分で設定する。これらを入力し、認証を受けることでシステムに接続される。|
  |2.1.2|ログアウト|他者が利用者の保持しているセッションに再接続し、セッションを乗っ取ることを防ぐため。|システムへの接続を終了する。|
  |2.1.3|利用者登録|利用者登録を行い、認証した者のみがシステムを使えるという制限を設けるため。|ログインID、パスワードを利用者情報（user）とし、これを登録する。<br>ログインIDは15文字以内。<br>パスワードは10文字以内。|
  |2.1.4|閲覧|大会情報、選手情報、出場大会情報、対戦結果情報を参照するため。|大会情報、選手情報、出場大会、対戦結果情報を閲覧する。|
  |2.1.5|大会の登録|大会の情報を記録するため。|大会名、期間（始まりと終わりの日）、開催場所を大会情報（tournament）として登録する。<br>大会名は20文字以内。<br>開催場所は20文字以内。|
  |2.1.6|選手の登録|選手の情報を記録するため。|選手名、性別、戦型、ラバーの種類を選手情報（player）として登録する。<br>選手名は15文字以内。<br>性別は「男」「女」の2種類から選択。<br>戦型は20文字以内。<br>ラバーの種類は20文字以内。|
  |2.1.7|出場大会の登録|選手の出場大会を記録するため。|選手名、大会名を出場大会情報(played_tournament)として登録する。|
  |2.1.8|戦績情報の登録|対戦結果を記録するため。|選手名、大会名、対戦日、ゲームカウント、対戦位置、登録者名を戦績情報（record）として登録する。<br>対戦日はdate型。<br>ゲームカウントは「2-3」のように登録する。3文字。<br>対戦位置は15文字以内。<br>登録者名は15文字以内。|
  |2.1.9|大会検索|見たい大会情報を見つけるため。|大会名を指定することで、その大会情報を閲覧することができる。|
  |2.1.10|選手検索|見たい選手情報を見つけるため。|選手名を指定することで、その選手情報を閲覧することができる。|
  |2.1.11|出場大会検索|見たい出場大会情報を見つけるため。|選手名または大会名を指定することで、その出場大会情報を閲覧することができる。|
  |2.1.12|対戦結果検索|見たい対戦結果情報を見つけるため。|大会名と対戦相手の選手名と登録者名を指定することで、その試合結果を閲覧することができる。|

  ### 3.非機能要求
  |ID|機能名|理由|説明|
  |----|----|-----|-----|
  |3.1|XSS対策|攻撃者によって利用者が偽ページに誘導され、個人情報等を抜き取られないようにするため。|開発時には脆弱性を作りこまないように、IPAの安全なwebサイトの作り方を参照し、セキュリティ実装の状況を随時確認する。運用時は定期的にセキュリティ監査を行う。|
  |3.2|ロールベースアクセス制御|認められたユーザのシステムアクセスを制御するため。|「利用者」には利用者の機能を使用する権限を、「管理者」には利用者の機能及び管理者の機能を使用する権限を与える。この権限をもとに、ユーザ情報に格納していく。|
  |3.3|url直打ちでのJSPファイルへのアクセス禁止|利用者以外の者が本来アクセスすることのできないページにアクセスすることを防ぐため。|本来アクセスすることができないページにurl直打ちでアクセスしようとした際には、そのurlを一時的に保持し、アクセスするための認証画面へ遷移させる。認証が完了すれば保持しているurlを返す。|
  |3.4|タイムアウト時間の設定|タイムアウトする前に保持されているセッションに、他者が再接続し、セッションを乗っ取られることを防ぐため。|セッションの保持時間は2時間に設定する。|

   ## 4.DB設計書
   DB名は「tabletennis」とする。
   ### 4.1 利用者テーブル「user」
   |カラム名|和名|型|NULL|主キー|備考|
   |------|-----|----|-----|----|------|
   |user_id|利用者ID|int|NO|〇||
   |login_id|ログインID|varchar(15)|NO|||
   |password|パスワード|varchar(10)|NO||||

   ### 4.2 大会テーブル「tournament」
   |カラム名|和名|型|NULL|主キー|備考|
   |------|-----|----|-----|----|------|
   |tournament_name|大会名|varchar(20)|NO|||
   |tournament_id|大会ID|int|NO|〇||
   |term|期間|date|NO|||
   |place|開催場所|varchar(20)|NO||||
   |user_id|利用者ID|int|NO|||

   ### 4.3 選手テーブル「player」
   |カラム名|和名|型|NULL|主キー|備考|
   |------|-----|----|-----|----|------|
   |player_id|選手ID|int|NO|〇||
   |player_name|選手名|varchar(15)|NO|||
   |type|戦型|int|YES||0~3|
   |rubber|ラバーの種類|varchar(20)|YES|||
   |sex|性別|int|YES||0,1|
   |user_id|利用者ID|int|NO|||

   ### 4.4 戦績テーブル「record」
   |カラム名|和名|型|NULL|主キー|備考|
   |------|-----|----|-----|----|------|
   |record_id|戦績ID|int|NO|〇||
   |tournament_id|大会ID|int|NO|||
   |player_id|選手ID|int|NO|||
   |tournament_day|対戦日|date|NO|||
   |count|ゲームカウント|int|NO|||
   |battle_stage|対戦位置|varchar(15)|NO||||
   |user_id|利用者ID|int|NO|||

   ### 4.5 出場大会テーブル「played_tournament」
   |カラム名|和名|型|NULL|主キー|備考|
   |------|-----|----|-----|----|------|
   |played_tournament_id|出場大会ID|int|NO|〇||
   |player_id|選手ID|int|NO|||
   |tournament_id|大会ID|int|NO||||
   |user_id|利用者ID|int|NO|||

   ### 4.6 戦績・選手関連テーブル「record_player_relation」
   |カラム名|和名|型|NULL|主キー|備考|
   |------|-----|----|-----|----|------|
   |rel_id|レコード識別|int|NO|〇||
   |player_id|選手ID|int|NO|||
   |record_id|戦績ID|int|NO||||
